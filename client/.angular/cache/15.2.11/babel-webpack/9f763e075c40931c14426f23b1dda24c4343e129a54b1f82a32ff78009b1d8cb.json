{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/price.service\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction ChestEvaluatorComponent_option_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", s_r3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(s_r3);\n  }\n}\nfunction ChestEvaluatorComponent_section_6_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 7)(1, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ChestEvaluatorComponent_section_6_li_4_Template_button_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const c_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r6.selectChest(c_r5));\n    });\n    i0.ɵɵelementStart(2, \"figure\");\n    i0.ɵɵelement(3, \"img\", 9);\n    i0.ɵɵelementStart(4, \"figcaption\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const c_r5 = ctx.$implicit;\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵclassProp(\"selected\", c_r5 === ctx_r4.selectedChest);\n    i0.ɵɵpropertyInterpolate(\"aria-pressed\", c_r5 === ctx_r4.selectedChest);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", c_r5.imagePath, i0.ɵɵsanitizeUrl)(\"alt\", c_r5.displayName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(c_r5.displayName);\n  }\n}\nfunction ChestEvaluatorComponent_section_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"section\")(1, \"h2\");\n    i0.ɵɵtext(2, \"Choisir votre coffre\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ul\", 5);\n    i0.ɵɵtemplate(4, ChestEvaluatorComponent_section_6_li_4_Template, 6, 6, \"li\", 6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.chests)(\"ngForTrackBy\", ctx_r1.trackByDisplayName);\n  }\n}\nfunction ChestEvaluatorComponent_section_7_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 15);\n    i0.ɵɵelement(1, \"img\", 16);\n    i0.ɵɵelementStart(2, \"div\", 17)(3, \"span\", 18);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"span\", 19);\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"percent\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 20)(9, \"label\", 21);\n    i0.ɵɵtext(10, \"Prix :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"input\", 22);\n    i0.ɵɵlistener(\"ngModelChange\", function ChestEvaluatorComponent_section_7_li_4_Template_input_ngModelChange_11_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const item_r9 = restoredCtx.$implicit;\n      return i0.ɵɵresetView(item_r9.userPrice = $event);\n    })(\"ngModelChange\", function ChestEvaluatorComponent_section_7_li_4_Template_input_ngModelChange_11_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const item_r9 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r12.onPriceChange(item_r9));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r9 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", item_r9.imagePath, i0.ɵɵsanitizeUrl)(\"alt\", item_r9.name);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(item_r9.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(7, 8, item_r9.probability, \"1.0-2\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"for\", \"price-\" + item_r9.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"id\", \"price-\" + item_r9.name);\n    i0.ɵɵpropertyInterpolate1(\"aria-label\", \"Prix unitaire de \", item_r9.name, \"\");\n    i0.ɵɵproperty(\"ngModel\", item_r9.userPrice);\n  }\n}\nfunction ChestEvaluatorComponent_section_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"section\")(1, \"h3\");\n    i0.ɵɵtext(2, \"Contenu du coffre\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ul\", 10);\n    i0.ɵɵtemplate(4, ChestEvaluatorComponent_section_7_li_4_Template, 12, 11, \"li\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function ChestEvaluatorComponent_section_7_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.calculateTotal());\n    });\n    i0.ɵɵtext(6, \" Pricer \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 13);\n    i0.ɵɵelement(8, \"img\", 14);\n    i0.ɵɵelementStart(9, \"span\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"number\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.selectedChest.outcomes)(\"ngForTrackBy\", ctx_r2.trackByName);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(11, 3, ctx_r2.totalPrice, \"1.2-2\"));\n  }\n}\nexport class ChestEvaluatorComponent {\n  constructor(priceService, http) {\n    this.priceService = priceService;\n    this.http = http;\n    this.stages = ['Etage 230–269 (Fantastique)', 'Etage 270–323 (Imaginaire)', 'Etage 324+ (Brumeux)'];\n    this.selectedStage = '';\n    this.chests = [];\n    this.selectedChest = null;\n    this.totalPrice = 0;\n  }\n  ngOnInit() {\n    // initially no chests; they load on stage change\n  }\n  onStageChange() {\n    this.selectedChest = null;\n    this.totalPrice = 0;\n    // fetch or filter chests by `this.selectedStage`\n    this.http.get(`https://localhost:5001/api/chests?stage=${encodeURIComponent(this.selectedStage)}`).subscribe(data => this.chests = data);\n  }\n  selectChest(chest) {\n    this.selectedChest = {\n      ...chest\n    };\n    this.priceService.setPrice('', 0); // reset\n    this.totalPrice = 0;\n  }\n  onPriceChange(item) {\n    this.priceService.setPrice(item.category, item.userPrice);\n    this.priceService.syncCategory(item.category, this.selectedChest.outcomes);\n    this.calculateTotal();\n  }\n  calculateTotal() {\n    this.totalPrice = this.selectedChest.outcomes.reduce((sum, i) => sum + i.probability * (i.userPrice || 0), 0);\n  }\n  static {\n    this.ɵfac = function ChestEvaluatorComponent_Factory(t) {\n      return new (t || ChestEvaluatorComponent)(i0.ɵɵdirectiveInject(i1.PriceService), i0.ɵɵdirectiveInject(i2.HttpClient));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ChestEvaluatorComponent,\n      selectors: [[\"app-chest-evaluator\"]],\n      decls: 8,\n      vars: 4,\n      consts: [[1, \"container\"], [\"aria-label\", \"S\\u00E9lectionnez votre \\u00E9tage\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [3, \"value\"], [\"role\", \"list\", 1, \"card-grid\"], [\"class\", \"card\", 4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [1, \"card\"], [\"type\", \"button\", 1, \"card-button\", 3, \"aria-pressed\", \"click\"], [\"width\", \"150\", \"height\", \"150\", 3, \"src\", \"alt\"], [\"role\", \"list\", 1, \"loot-grid\"], [\"class\", \"loot-item\", 4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [1, \"price-button\", 3, \"click\"], [\"role\", \"status\", \"aria-live\", \"polite\", 1, \"price-output\"], [\"src\", \"assets/kamas.png\", \"alt\", \"kamas\", \"width\", \"32\", \"height\", \"32\"], [1, \"loot-item\"], [\"width\", \"40\", \"height\", \"40\", 3, \"src\", \"alt\"], [1, \"loot-info\"], [1, \"loot-name\"], [1, \"loot-prob\"], [1, \"loot-price\"], [3, \"for\"], [\"type\", \"number\", \"min\", \"0\", \"step\", \"any\", 3, \"id\", \"ngModel\", \"aria-label\", \"ngModelChange\"]],\n      template: function ChestEvaluatorComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"main\", 0)(1, \"fieldset\")(2, \"legend\");\n          i0.ɵɵtext(3, \"S\\u00E9lectionnez votre \\u00E9tage\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"select\", 1);\n          i0.ɵɵlistener(\"ngModelChange\", function ChestEvaluatorComponent_Template_select_ngModelChange_4_listener($event) {\n            return ctx.selectedStage = $event;\n          })(\"change\", function ChestEvaluatorComponent_Template_select_change_4_listener() {\n            return ctx.onStageChange();\n          });\n          i0.ɵɵtemplate(5, ChestEvaluatorComponent_option_5_Template, 2, 2, \"option\", 2);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(6, ChestEvaluatorComponent_section_6_Template, 5, 2, \"section\", 3);\n          i0.ɵɵtemplate(7, ChestEvaluatorComponent_section_7_Template, 12, 6, \"section\", 3);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.selectedStage);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngForOf\", ctx.stages);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.selectedStage);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.selectedChest);\n        }\n      },\n      dependencies: [i3.NgForOf, i3.NgIf, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.MinValidator, i4.NgModel, i3.DecimalPipe, i3.PercentPipe],\n      styles: [\".container[_ngcontent-%COMP%] {\\n  padding: 20px;\\n  background: #1e1e2f;\\n  color: white;\\n}\\n\\n.card-grid[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 10px;\\n}\\n\\n.card[_ngcontent-%COMP%] {\\n  border: 2px solid #666;\\n  padding: 10px;\\n  cursor: pointer;\\n  background: #1e1e2f;\\n  text-align: center;\\n}\\n\\n.card.selected[_ngcontent-%COMP%] {\\n  border-color: #ffd700;\\n  background: #323245;\\n}\\n\\n.loot-grid[_ngcontent-%COMP%] {\\n  display: grid;\\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\\n  gap: 10px;\\n  margin: 10px 0;\\n}\\n\\n.loot-item[_ngcontent-%COMP%] {\\n  display: flex;\\n  align-items: center;\\n  gap: 8px;\\n}\\n\\n.price-output[_ngcontent-%COMP%] {\\n  display: flex;\\n  align-items: center;\\n  gap: 6px;\\n  margin-top: 10px;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9jaGVzdC1ldmFsdWF0b3IvY2hlc3QtZXZhbHVhdG9yLmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQWEsYUFBQTtFQUFlLG1CQUFBO0VBQXFCLFlBQUE7QUFJakQ7O0FBSEE7RUFBYSxhQUFBO0VBQWUsZUFBQTtFQUFpQixTQUFBO0FBUzdDOztBQVJBO0VBQ0Usc0JBQUE7RUFBd0IsYUFBQTtFQUFlLGVBQUE7RUFDdkMsbUJBQUE7RUFBcUIsa0JBQUE7QUFjdkI7O0FBWkE7RUFBaUIscUJBQUE7RUFBdUIsbUJBQUE7QUFpQnhDOztBQWhCQTtFQUFhLGFBQUE7RUFBZSwyREFBQTtFQUE0RCxTQUFBO0VBQVcsY0FBQTtBQXVCbkc7O0FBdEJBO0VBQWEsYUFBQTtFQUFlLG1CQUFBO0VBQXFCLFFBQUE7QUE0QmpEOztBQTNCQTtFQUFnQixhQUFBO0VBQWUsbUJBQUE7RUFBcUIsUUFBQTtFQUFVLGdCQUFBO0FBa0M5RCIsInNvdXJjZXNDb250ZW50IjpbIi5jb250YWluZXIgeyBwYWRkaW5nOiAyMHB4OyBiYWNrZ3JvdW5kOiAjMWUxZTJmOyBjb2xvcjogd2hpdGU7IH1cclxuLmNhcmQtZ3JpZCB7IGRpc3BsYXk6IGZsZXg7IGZsZXgtd3JhcDogd3JhcDsgZ2FwOiAxMHB4OyB9XHJcbi5jYXJkIHtcclxuICBib3JkZXI6IDJweCBzb2xpZCAjNjY2OyBwYWRkaW5nOiAxMHB4OyBjdXJzb3I6IHBvaW50ZXI7XHJcbiAgYmFja2dyb3VuZDogIzFlMWUyZjsgdGV4dC1hbGlnbjogY2VudGVyO1xyXG59XHJcbi5jYXJkLnNlbGVjdGVkIHsgYm9yZGVyLWNvbG9yOiAjZmZkNzAwOyBiYWNrZ3JvdW5kOiAjMzIzMjQ1OyB9XHJcbi5sb290LWdyaWQgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpdCwgbWlubWF4KDIwMHB4LDFmcikpOyBnYXA6IDEwcHg7IG1hcmdpbjogMTBweCAwOyB9XHJcbi5sb290LWl0ZW0geyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDhweDsgfVxyXG4ucHJpY2Utb3V0cHV0IHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA2cHg7IG1hcmdpbi10b3A6IDEwcHg7IH0iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["i0","ChestEvaluatorComponent","constructor","priceService","http","ngOnInit","onStageChange","selectedChest","totalPrice","get","encodeURIComponent","selectedStage","subscribe","data","chests","selectChest","chest","setPrice","onPriceChange","item","category","userPrice","syncCategory","outcomes","calculateTotal","reduce","sum","i","probability","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\tsouf\\dofus-evaluator-webapp\\client\\src\\app\\components\\chest-evaluator\\chest-evaluator.component.html","C:\\Users\\tsouf\\dofus-evaluator-webapp\\client\\src\\app\\components\\chest-evaluator\\chest-evaluator.component.ts"],"sourcesContent":["<main class=\"container\">\n  <!-- Stage selector -->\n  <fieldset>\n    <legend>Sélectionnez votre étage</legend>\n    <select\n      [(ngModel)]=\"selectedStage\"\n      (change)=\"onStageChange()\"\n      aria-label=\"Sélectionnez votre étage\"\n    >\n      <option *ngFor=\"let s of stages\" [value]=\"s\">{{ s }}</option>\n    </select>\n  </fieldset>\n\n  <!-- Chest chooser -->\n  <section *ngIf=\"selectedStage\">\n    <h2>Choisir votre coffre</h2>\n    <ul class=\"card-grid\" role=\"list\">\n      <li\n        *ngFor=\"let c of chests; trackBy: trackByDisplayName\"\n        class=\"card\"\n      >\n        <button\n          type=\"button\"\n          class=\"card-button\"\n          [class.selected]=\"c === selectedChest\"\n          (click)=\"selectChest(c)\"\n          aria-pressed=\"{{ c === selectedChest }}\"\n        >\n          <figure>\n            <img\n              [src]=\"c.imagePath\"\n              [alt]=\"c.displayName\"\n              width=\"150\"\n              height=\"150\"\n            />\n            <figcaption>{{ c.displayName }}</figcaption>\n          </figure>\n        </button>\n      </li>\n    </ul>\n  </section>\n\n  <!-- Outcome & pricing -->\n  <section *ngIf=\"selectedChest\">\n    <h3>Contenu du coffre</h3>\n    <ul class=\"loot-grid\" role=\"list\">\n      <li\n        *ngFor=\"let item of selectedChest.outcomes; trackBy: trackByName\"\n        class=\"loot-item\"\n      >\n        <img\n          [src]=\"item.imagePath\"\n          [alt]=\"item.name\"\n          width=\"40\"\n          height=\"40\"\n        />\n        <div class=\"loot-info\">\n          <span class=\"loot-name\">{{ item.name }}</span>\n          <span class=\"loot-prob\">{{ item.probability | percent:'1.0-2' }}</span>\n        </div>\n        <div class=\"loot-price\">\n          <label [for]=\"'price-' + item.name\">Prix :</label>\n          <input\n            id=\"{{ 'price-' + item.name }}\"\n            type=\"number\"\n            min=\"0\"\n            step=\"any\"\n            [(ngModel)]=\"item.userPrice\"\n            (ngModelChange)=\"onPriceChange(item)\"\n            aria-label=\"Prix unitaire de {{ item.name }}\"\n          />\n        </div>\n      </li>\n    </ul>\n\n    <button class=\"price-button\" (click)=\"calculateTotal()\">\n      Pricer\n    </button>\n\n    <div class=\"price-output\" role=\"status\" aria-live=\"polite\">\n      <img\n        src=\"assets/kamas.png\"\n        alt=\"kamas\"\n        width=\"32\"\n        height=\"32\"\n      />\n      <span>{{ totalPrice | number:'1.2-2' }}</span>\n    </div>\n  </section>\n</main>","import { Component, OnInit } from '@angular/core';\nimport { PriceService } from '../../services/price.service';\nimport { HttpClient } from '@angular/common/http';\nimport { Chest } from '../../models/chest.model';\nimport { LootItem } from '../../models/loot-item.model';\n\n\n\n@Component({\n  selector: 'app-chest-evaluator',\n  templateUrl: './chest-evaluator.component.html',\n  styleUrls: ['./chest-evaluator.component.scss'],\n})\nexport class ChestEvaluatorComponent implements OnInit {\n  stages = [\n    'Etage 230–269 (Fantastique)',\n    'Etage 270–323 (Imaginaire)',\n    'Etage 324+ (Brumeux)',\n  ];\n  selectedStage = '';\n  chests: Chest[] = [];\n  selectedChest: Chest | null = null;\n  totalPrice = 0;\n\n  constructor(\n    private priceService: PriceService,\n    private http: HttpClient\n  ) {}\n\n  ngOnInit() {\n    // initially no chests; they load on stage change\n  }\n\n  onStageChange() {\n    this.selectedChest = null;\n    this.totalPrice = 0;\n    // fetch or filter chests by `this.selectedStage`\n    this.http\n      .get<Chest[]>(\n        `https://localhost:5001/api/chests?stage=${encodeURIComponent(this.selectedStage)}`\n      )\n      .subscribe(data => (this.chests = data));\n  }\n\n  selectChest(chest: Chest) {\n    this.selectedChest = { ...chest };\n    this.priceService.setPrice('', 0); // reset\n    this.totalPrice = 0;\n  }\n\n  onPriceChange(item: LootItem) {\n    this.priceService.setPrice(item.category, item.userPrice);\n    this.priceService.syncCategory(item.category, this.selectedChest!.outcomes);\n    this.calculateTotal();\n  }\n\n  calculateTotal() {\n    this.totalPrice = this.selectedChest!.outcomes.reduce(\n      (sum, i) => sum + i.probability * (i.userPrice || 0),\n      0\n    );\n  }\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}