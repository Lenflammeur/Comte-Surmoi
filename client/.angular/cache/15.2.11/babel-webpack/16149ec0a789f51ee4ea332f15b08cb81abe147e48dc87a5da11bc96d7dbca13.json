{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/price.service\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction ChestEvaluatorComponent_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 6);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", s_r4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(s_r4);\n  }\n}\nfunction ChestEvaluatorComponent_h2_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\");\n    i0.ɵɵtext(1, \"Choisir votre coffre\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ChestEvaluatorComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵlistener(\"click\", function ChestEvaluatorComponent_div_7_Template_div_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const c_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.selectChest(c_r5));\n    });\n    i0.ɵɵelement(1, \"img\", 8);\n    i0.ɵɵelementStart(2, \"span\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const c_r5 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"selected\", c_r5 === ctx_r2.selectedChest);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", c_r5.imagePath, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(c_r5.displayName);\n  }\n}\nfunction ChestEvaluatorComponent_section_8_div_4_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵelement(1, \"img\", 17);\n    i0.ɵɵelementStart(2, \"div\", 18)(3, \"span\", 19);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"span\", 20);\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"percent\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"input\", 21);\n    i0.ɵɵlistener(\"ngModelChange\", function ChestEvaluatorComponent_section_8_div_4_div_1_Template_input_ngModelChange_8_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const item_r11 = restoredCtx.$implicit;\n      return i0.ɵɵresetView(item_r11.userPrice = $event);\n    })(\"ngModelChange\", function ChestEvaluatorComponent_section_8_div_4_div_1_Template_input_ngModelChange_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const item_r11 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r14.onPriceChange(item_r11));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r11 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", item_r11.imagePath, i0.ɵɵsanitizeUrl)(\"alt\", item_r11.name);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(item_r11.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(7, 6, item_r11.probability, \"1.0-2\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"aria-label\", \"Prix unitaire de \", item_r11.name, \"\");\n    i0.ɵɵproperty(\"ngModel\", item_r11.userPrice);\n  }\n}\nfunction ChestEvaluatorComponent_section_8_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtemplate(1, ChestEvaluatorComponent_section_8_div_4_div_1_Template, 9, 9, \"div\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const col_r9 = ctx.$implicit;\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", col_r9)(\"ngForTrackBy\", ctx_r8.trackByName);\n  }\n}\nfunction ChestEvaluatorComponent_section_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"section\")(1, \"h3\");\n    i0.ɵɵtext(2, \"Contenu du coffre\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 9);\n    i0.ɵɵtemplate(4, ChestEvaluatorComponent_section_8_div_4_Template, 2, 2, \"div\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function ChestEvaluatorComponent_section_8_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.calculateTotal());\n    });\n    i0.ɵɵtext(6, \"Pricer\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 12);\n    i0.ɵɵelement(8, \"img\", 13);\n    i0.ɵɵelementStart(9, \"span\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"number\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.groupedOutcomes)(\"ngForTrackBy\", ctx_r3.trackByIndex);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(11, 3, ctx_r3.totalPrice, \"1.2-2\"));\n  }\n}\nexport class ChestEvaluatorComponent {\n  constructor(priceService, http) {\n    this.priceService = priceService;\n    this.http = http;\n    this.stages = ['Etage 230–269 (Fantastique)', 'Etage 270–323 (Imaginaire)', 'Etage 324+ (Brumeux)'];\n    this.selectedStage = '';\n    this.chests = [];\n    this.selectedChest = null;\n    this.groupedOutcomes = [];\n    this.totalPrice = 0;\n  }\n  ngOnInit() {\n    // initially no chests; they load on stage change\n  }\n  onStageChange() {\n    this.selectedChest = null;\n    this.totalPrice = 0;\n    const url = `http://localhost:5268/api/chests?stage=${encodeURIComponent(this.selectedStage)}`;\n    this.http.get(url).subscribe(data => {\n      console.log('Chest data from API:', data);\n      this.chests = data;\n    }, err => console.error('API error:', err));\n  }\n  chunk(arr, size) {\n    const groups = [];\n    for (let i = 0; i < arr.length; i += size) {\n      groups.push(arr.slice(i, i + size));\n    }\n    return groups;\n  }\n  selectChest(chest) {\n    // Keep the raw chest\n    this.selectedChest = chest;\n    // 1) Attach an imagePath to each outcome if not already present\n    chest.outcomes.forEach(o => {\n      o.imagePath = `assets/${o.category.toLowerCase()}.png`;\n      // default quantity is already in the model\n    });\n    // 2) Build your columns: 5 items each\n    this.groupedOutcomes = this.chunk(chest.outcomes, 5);\n    // reset price\n    this.totalPrice = 0;\n  }\n  onPriceChange(item) {\n    this.priceService.setPrice(item.category, item.userPrice);\n    this.priceService.syncCategory(item.category, this.selectedChest.outcomes);\n    this.calculateTotal();\n  }\n  calculateTotal() {\n    this.totalPrice = this.selectedChest.outcomes.reduce((sum, i) => sum + i.probability * (i.userPrice || 0), 0);\n  }\n  static {\n    this.ɵfac = function ChestEvaluatorComponent_Factory(t) {\n      return new (t || ChestEvaluatorComponent)(i0.ɵɵdirectiveInject(i1.PriceService), i0.ɵɵdirectiveInject(i2.HttpClient));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ChestEvaluatorComponent,\n      selectors: [[\"app-chest-evaluator\"]],\n      decls: 9,\n      vars: 5,\n      consts: [[1, \"container\"], [3, \"ngModel\", \"ngModelChange\", \"change\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"card-grid\"], [\"class\", \"card\", 3, \"selected\", \"click\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [1, \"card\", 3, \"click\"], [3, \"src\"], [1, \"loot-columns\"], [\"class\", \"loot-column\", 4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [3, \"click\"], [1, \"price-output\"], [\"src\", \"assets/kamas.png\", \"alt\", \"kamas\", \"width\", \"32\"], [1, \"loot-column\"], [\"class\", \"loot-item\", 4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [1, \"loot-item\"], [\"width\", \"40\", \"height\", \"40\", 1, \"loot-icon\", 3, \"src\", \"alt\"], [1, \"loot-details\"], [1, \"loot-name\"], [1, \"loot-prob\"], [\"type\", \"number\", \"min\", \"0\", \"step\", \"any\", 3, \"ngModel\", \"aria-label\", \"ngModelChange\"]],\n      template: function ChestEvaluatorComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"label\");\n          i0.ɵɵtext(2, \"S\\u00E9lectionnez votre \\u00E9tage:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"select\", 1);\n          i0.ɵɵlistener(\"ngModelChange\", function ChestEvaluatorComponent_Template_select_ngModelChange_3_listener($event) {\n            return ctx.selectedStage = $event;\n          })(\"change\", function ChestEvaluatorComponent_Template_select_change_3_listener() {\n            return ctx.onStageChange();\n          });\n          i0.ɵɵtemplate(4, ChestEvaluatorComponent_option_4_Template, 2, 2, \"option\", 2);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(5, ChestEvaluatorComponent_h2_5_Template, 2, 0, \"h2\", 3);\n          i0.ɵɵelementStart(6, \"div\", 4);\n          i0.ɵɵtemplate(7, ChestEvaluatorComponent_div_7_Template, 4, 4, \"div\", 5);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(8, ChestEvaluatorComponent_section_8_Template, 12, 6, \"section\", 3);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngModel\", ctx.selectedStage);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngForOf\", ctx.stages);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.selectedStage);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.chests);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.selectedChest);\n        }\n      },\n      dependencies: [i3.NgForOf, i3.NgIf, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.MinValidator, i4.NgModel, i3.DecimalPipe, i3.PercentPipe],\n      styles: [\".container[_ngcontent-%COMP%] {\\n  padding: 20px;\\n  background: #1e1e2f;\\n  color: white;\\n}\\n\\n.card-grid[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 10px;\\n}\\n\\n.card[_ngcontent-%COMP%] {\\n  border: 2px solid #666;\\n  padding: 10px;\\n  cursor: pointer;\\n  background: #1e1e2f;\\n  text-align: center;\\n}\\n\\n.card.selected[_ngcontent-%COMP%] {\\n  border-color: #ffd700;\\n  background: #323245;\\n}\\n\\n.loot-grid[_ngcontent-%COMP%] {\\n  display: grid;\\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\\n  gap: 10px;\\n  margin: 10px 0;\\n}\\n\\n.loot-item[_ngcontent-%COMP%] {\\n  display: flex;\\n  align-items: center;\\n  gap: 8px;\\n}\\n\\n.price-output[_ngcontent-%COMP%] {\\n  display: flex;\\n  align-items: center;\\n  gap: 6px;\\n  margin-top: 10px;\\n}\\n\\n.loot-columns[_ngcontent-%COMP%] {\\n  display: flex;\\n  gap: 1rem;\\n}\\n\\n.loot-column[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 0.5rem;\\n}\\n\\n.loot-item[_ngcontent-%COMP%] {\\n  display: flex;\\n  align-items: center;\\n  gap: 0.5rem;\\n}\\n\\n.loot-icon[_ngcontent-%COMP%] {\\n  flex-shrink: 0;\\n}\\n\\n.loot-details[_ngcontent-%COMP%] {\\n  display: grid;\\n  grid-template-columns: 1fr auto;\\n  gap: 0.5rem;\\n  align-items: center;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9jaGVzdC1ldmFsdWF0b3IvY2hlc3QtZXZhbHVhdG9yLmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQWEsYUFBQTtFQUFlLG1CQUFBO0VBQXFCLFlBQUE7QUFJakQ7O0FBSEE7RUFBYSxhQUFBO0VBQWUsZUFBQTtFQUFpQixTQUFBO0FBUzdDOztBQVJBO0VBQ0Usc0JBQUE7RUFBd0IsYUFBQTtFQUFlLGVBQUE7RUFDdkMsbUJBQUE7RUFBcUIsa0JBQUE7QUFjdkI7O0FBWkE7RUFBaUIscUJBQUE7RUFBdUIsbUJBQUE7QUFpQnhDOztBQWhCQTtFQUFhLGFBQUE7RUFBZSwyREFBQTtFQUE0RCxTQUFBO0VBQVcsY0FBQTtBQXVCbkc7O0FBdEJBO0VBQWEsYUFBQTtFQUFlLG1CQUFBO0VBQXFCLFFBQUE7QUE0QmpEOztBQTNCQTtFQUFnQixhQUFBO0VBQWUsbUJBQUE7RUFBcUIsUUFBQTtFQUFVLGdCQUFBO0FBa0M5RDs7QUFoQ0E7RUFDRSxhQUFBO0VBQ0EsU0FBQTtBQW1DRjs7QUFoQ0E7RUFDRSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSxXQUFBO0FBbUNGOztBQWhDQTtFQUNFLGFBQUE7RUFDQSxtQkFBQTtFQUNBLFdBQUE7QUFtQ0Y7O0FBaENBO0VBQ0UsY0FBQTtBQW1DRjs7QUFoQ0E7RUFDRSxhQUFBO0VBQ0EsK0JBQUE7RUFDQSxXQUFBO0VBQ0EsbUJBQUE7QUFtQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIuY29udGFpbmVyIHsgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZDogIzFlMWUyZjsgY29sb3I6IHdoaXRlOyB9XHJcbi5jYXJkLWdyaWQgeyBkaXNwbGF5OiBmbGV4OyBmbGV4LXdyYXA6IHdyYXA7IGdhcDogMTBweDsgfVxyXG4uY2FyZCB7XHJcbiAgYm9yZGVyOiAycHggc29saWQgIzY2NjsgcGFkZGluZzogMTBweDsgY3Vyc29yOiBwb2ludGVyO1xyXG4gIGJhY2tncm91bmQ6ICMxZTFlMmY7IHRleHQtYWxpZ246IGNlbnRlcjtcclxufVxyXG4uY2FyZC5zZWxlY3RlZCB7IGJvcmRlci1jb2xvcjogI2ZmZDcwMDsgYmFja2dyb3VuZDogIzMyMzI0NTsgfVxyXG4ubG9vdC1ncmlkIHsgZGlzcGxheTogZ3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoYXV0by1maXQsIG1pbm1heCgyMDBweCwxZnIpKTsgZ2FwOiAxMHB4OyBtYXJnaW46IDEwcHggMDsgfVxyXG4ubG9vdC1pdGVtIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA4cHg7IH1cclxuLnByaWNlLW91dHB1dCB7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogNnB4OyBtYXJnaW4tdG9wOiAxMHB4OyB9XHJcblxyXG4ubG9vdC1jb2x1bW5zIHtcclxuICBkaXNwbGF5OiBmbGV4O1xyXG4gIGdhcDogMXJlbTtcclxufVxyXG5cclxuLmxvb3QtY29sdW1uIHtcclxuICBkaXNwbGF5OiBmbGV4O1xyXG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XHJcbiAgZ2FwOiAwLjVyZW07XHJcbn1cclxuXHJcbi5sb290LWl0ZW0ge1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuICBnYXA6IDAuNXJlbTtcclxufVxyXG5cclxuLmxvb3QtaWNvbiB7XHJcbiAgZmxleC1zaHJpbms6IDA7XHJcbn1cclxuXHJcbi5sb290LWRldGFpbHMge1xyXG4gIGRpc3BsYXk6IGdyaWQ7XHJcbiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgYXV0bztcclxuICBnYXA6IDAuNXJlbTtcclxuICBhbGlnbi1pdGVtczogY2VudGVyO1xyXG59Il0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["i0","ChestEvaluatorComponent","constructor","priceService","http","ngOnInit","onStageChange","selectedChest","totalPrice","url","encodeURIComponent","selectedStage","get","subscribe","data","console","log","chests","err","error","chunk","arr","size","groups","i","length","push","slice","selectChest","chest","outcomes","forEach","o","imagePath","category","toLowerCase","groupedOutcomes","onPriceChange","item","setPrice","userPrice","syncCategory","calculateTotal","reduce","sum","probability","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\tsouf\\dofus-evaluator-webapp\\client\\src\\app\\components\\chest-evaluator\\chest-evaluator.component.html","C:\\Users\\tsouf\\dofus-evaluator-webapp\\client\\src\\app\\components\\chest-evaluator\\chest-evaluator.component.ts"],"sourcesContent":["<div class=\"container\">\n  <label>Sélectionnez votre étage:</label>\n  <select [(ngModel)]=\"selectedStage\" (change)=\"onStageChange()\">\n    <option *ngFor=\"let s of stages\" [value]=\"s\">{{ s }}</option>\n  </select>\n\n  <h2 *ngIf=\"selectedStage\">Choisir votre coffre</h2>\n\n  <div class=\"card-grid\">\n    <div\n      class=\"card\"\n      *ngFor=\"let c of chests\"\n      [class.selected]=\"c === selectedChest\"\n      (click)=\"selectChest(c)\"\n    >\n      <img [src]=\"c.imagePath\" />\n      <span>{{ c.displayName }}</span>\n    </div>\n  </div>\n\n  <section *ngIf=\"selectedChest\">\n  <h3>Contenu du coffre</h3>\n\n  <div class=\"loot-columns\">\n    <div class=\"loot-column\" *ngFor=\"let col of groupedOutcomes; trackBy: trackByIndex\">\n      <div class=\"loot-item\" *ngFor=\"let item of col; trackBy: trackByName\">\n        <img\n          [src]=\"item.imagePath\"\n          [alt]=\"item.name\"\n          width=\"40\"\n          height=\"40\"\n          class=\"loot-icon\"\n        />\n        <div class=\"loot-details\">\n          <span class=\"loot-name\">{{ item.name }}</span>\n          <span class=\"loot-prob\">{{ item.probability | percent:'1.0-2' }}</span>\n          <input\n            type=\"number\"\n            min=\"0\"\n            step=\"any\"\n            [(ngModel)]=\"item.userPrice\"\n            (ngModelChange)=\"onPriceChange(item)\"\n            aria-label=\"Prix unitaire de {{ item.name }}\"\n          />\n        </div>\n      </div>\n    </div>\n  </div>\n  <button (click)=\"calculateTotal()\">Pricer</button>\n  <div class=\"price-output\">\n    <img src=\"assets/kamas.png\" alt=\"kamas\" width=\"32\" />\n    <span>{{ totalPrice | number:'1.2-2' }}</span>\n  </div>\n</section>\n</div>","import { Component, OnInit } from '@angular/core';\nimport { PriceService } from '../../services/price.service';\nimport { HttpClient } from '@angular/common/http';\nimport { Chest } from '../../models/chest.model';\nimport { LootItem } from '../../models/loot-item.model';\n\n\n\n@Component({\n  selector: 'app-chest-evaluator',\n  templateUrl: './chest-evaluator.component.html',\n  styleUrls: ['./chest-evaluator.component.scss'],\n})\nexport class ChestEvaluatorComponent implements OnInit {\n  stages = [\n    'Etage 230–269 (Fantastique)',\n    'Etage 270–323 (Imaginaire)',\n    'Etage 324+ (Brumeux)',\n  ];\n  selectedStage = '';\n  chests: Chest[] = [];\n  selectedChest: Chest | null = null;\n  groupedOutcomes: LootItem[][] = [];\n\n  totalPrice = 0;\n\n  constructor(\n    private priceService: PriceService,\n    private http: HttpClient\n  ) {}\n\n  ngOnInit() {\n    // initially no chests; they load on stage change\n  }\n\n  onStageChange() {\n  this.selectedChest = null;\n  this.totalPrice    = 0;\n\n  const url = `http://localhost:5268/api/chests?stage=${encodeURIComponent(this.selectedStage)}`;\n  this.http.get<Chest[]>(url)\n    .subscribe(\n      data => {\n        console.log('Chest data from API:', data);\n        this.chests = data;\n      },\n      err => console.error('API error:', err)\n    );\n}\nprivate chunk<T>(arr: T[], size: number): T[][] {\n    const groups: T[][] = [];\n    for (let i = 0; i < arr.length; i += size) {\n      groups.push(arr.slice(i, i + size));\n    }\n    return groups;\n  }\n\n\n\n  selectChest(chest: Chest) {\n    // Keep the raw chest\n    this.selectedChest = chest;\n\n    // 1) Attach an imagePath to each outcome if not already present\n    chest.outcomes.forEach(o => {\n      o.imagePath = `assets/${o.category.toLowerCase()}.png`;\n      // default quantity is already in the model\n    });\n\n    // 2) Build your columns: 5 items each\n    this.groupedOutcomes = this.chunk(chest.outcomes, 5);\n\n    // reset price\n    this.totalPrice = 0;\n  }\n\n\n\n  onPriceChange(item: LootItem) {\n    this.priceService.setPrice(item.category, item.userPrice);\n    this.priceService.syncCategory(item.category, this.selectedChest!.outcomes);\n    this.calculateTotal();\n  }\n\n  calculateTotal() {\n    this.totalPrice = this.selectedChest!.outcomes.reduce(\n      (sum, i) => sum + i.probability * (i.userPrice || 0),\n      0\n    );\n  }\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}